<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lighthouse: Advocacy for Mental Wellness</title>
    <!-- Load Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Google Font - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Load Phosphor Icons for simple visuals -->
    <script src="https://unpkg.com/phosphor-icons"></script>
    <style>
        /* Custom styles to ensure the Inter font is used everywhere */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb; /* Very light cool background */
            scroll-behavior: smooth;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #8b5cf6; /* Purple-500 */
            border-radius: 10px;
        }
        /* Style for the 'Get Help' button hover effect */
        .cta-button {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.4);
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        /* Modal animations */
        .overlay-hidden { opacity: 0; pointer-events: none; }
        .overlay-visible { opacity: 1; pointer-events: auto; transition: opacity 240ms ease; }
        .modal-panel { transform: translateY(12px) scale(0.995); opacity: 0; transition: transform 240ms ease, opacity 240ms ease; }
        .modal-panel-enter { transform: translateY(0) scale(1); opacity: 1; }
        .support-page { transform: translateY(12px) scale(0.995); opacity: 0; transition: transform 240ms ease, opacity 240ms ease; }
        .support-page-enter { transform: translateY(0) scale(1); opacity: 1; }
        /* Ensure readable text inside overlays/modals */
        .modal-panel, .support-page, #share-modal, #immediate-modal {
            color: #1f2937; /* Tailwind gray-800 */
        }
        /* Scrollable hospital lists inside modals/support page */
        .hospital-list-scroll {
            max-height: 40vh; /* responsive: takes a portion of viewport height */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* smooth scrolling on iOS */
            padding-right: 0.5rem;
        }
    </style>
    <script>
        // Simple client-side script for navigation
        function navigate(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // Simple script to toggle mobile menu
        function toggleMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }
    </script>
</head>
<body class="text-gray-800">

    <!-- Header / Navigation Bar -->
    <header class="bg-white shadow-md sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <!-- Logo/Brand -->
                <a href="#" class="flex items-center space-x-2 text-xl font-extrabold text-purple-600">
                    <i class="ph-lighthouse text-2xl"></i>
                    <span>Lighthouse</span>
                </a>

                <!-- Desktop Navigation -->
                <nav class="hidden md:flex space-x-8">
                    <a href="#" onclick="navigate('home')" class="text-gray-600 hover:text-purple-600 transition duration-150">Home</a>
                    <a href="#" onclick="navigate('about')" class="text-gray-600 hover:text-purple-600 transition duration-150">Our Mission</a>
                    <a href="#" onclick="navigate('resources')" class="text-gray-600 hover:text-purple-600 transition duration-150">Resources</a>
                </nav>

                <!-- Get Help Button -->
                <a href="#" onclick="openImmediate();" class="hidden md:block bg-purple-600 text-white py-2 px-4 rounded-full font-semibold hover:bg-purple-700 transition duration-300 shadow-lg shadow-purple-200">
                    Get Help Now
                </a>

                <!-- Mobile Menu Button -->
                <button class="md:hidden p-2 rounded-md text-gray-700 hover:bg-gray-100" onclick="toggleMenu()">
                    <i class="ph-list text-2xl"></i>
                </button>
            </div>
        </div>
        <!-- Mobile Menu Dropdown -->
        <div id="mobile-menu" class="hidden md:hidden px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-white">
            <a href="#" onclick="navigate('home'); toggleMenu();" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Home</a>
            <a href="#" onclick="navigate('about'); toggleMenu();" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Our Mission</a>
            <a href="#" onclick="navigate('resources'); toggleMenu();" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Resources</a>
            <a href="#" onclick="openImmediate(); toggleMenu();" class="block px-3 py-2 rounded-md text-base font-medium bg-purple-500 text-white text-center hover:bg-purple-600">Get Help Now</a>
        </div>
    </header>
    
    <main class="py-12">
        <!-- 1. Hero Section -->
        <section id="home" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center pt-10 pb-16">
            <div class="bg-indigo-50 p-6 sm:p-12 rounded-3xl">
                <h1 class="text-4xl sm:text-6xl font-extrabold tracking-tight text-indigo-800 leading-tight mb-4">
                    You Are Not Alone.
                </h1>
                <p class="mt-4 text-xl text-indigo-600 max-w-3xl mx-auto">
                    A safe space to understand the challenges of **Anxiety** and **Depression**, and connect with the support you need to move forward.
                </p>
                <div class="mt-8 flex justify-center space-x-4">
                    <a href="#" onclick="navigate('resources')" class="cta-button bg-purple-600 text-white text-lg font-bold py-3 px-8 rounded-full shadow-xl hover:bg-purple-700 transition duration-300">
                        Explore Resources
                    </a>
                    <a href="#" onclick="navigate('help')" class="cta-button bg-transparent border-2 border-purple-600 text-purple-600 text-lg font-bold py-3 px-8 rounded-full hover:bg-purple-50 transition duration-300">
                        Talk to Someone
                    </a>
                </div>
            </div>
        </section>

        <!-- 2. Core Message / Dual Challenge -->
        <section id="about" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <h2 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-4">Our Mission</h2>
            <p class="text-lg text-center text-gray-700 mb-10 max-w-3xl mx-auto">
                Our mission is to create a safe, supportive, and stigma-free space for individuals facing anxiety and depression. We believe that everyone deserves access to compassionate resources, professional help, and a caring community. By providing clear information, practical tools, and a sense of connection, we aim to empower people on their journey toward mental wellness and recovery.
            </p>
            <h3 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-12">The Dual Challenge: Understanding Anxiety and Depression</h3>
            <div class="grid md:grid-cols-2 gap-8 lg:gap-12">
                
                <!-- Anxiety Card -->
                <div class="card bg-white p-6 sm:p-8 rounded-xl border border-blue-100">
                    <div class="flex items-center space-x-4 mb-4">
                        <i class="ph-lightning text-4xl text-blue-500"></i>
                        <h3 class="text-2xl font-semibold text-blue-700">Anxiety: The Overwhelmed Mind</h3>
                    </div>
                    <p class="text-gray-600 leading-relaxed">
                        Anxiety is more than just stress. It's a persistent, excessive worry that interferes with daily life. It can manifest physically as a racing heart, shallow breath, or feeling constantly on edge. It's the mind spinning forward, anticipating worst-case scenarios and making the present moment feel unsafe.
                    </p>
                    <p class="mt-4 text-sm text-blue-500 font-medium">#Grounding #CopingSkills #Mindfulness</p>
                </div>

                <!-- Depression Card -->
                <div class="card bg-white p-6 sm:p-8 rounded-xl border border-purple-100">
                    <div class="flex items-center space-x-4 mb-4">
                        <i class="ph-cloud-rain text-4xl text-purple-500"></i>
                        <h3 class="text-2xl font-semibold text-purple-700">Depression: The Weight of Emptiness</h3>
                    </div>
                    <p class="text-gray-600 leading-relaxed">
                        Depression is a persistent feeling of sadness and loss of interest. It's an internal weight that saps energy, motivation, and joy. It can affect sleep, appetite, and concentration, making even small tasks feel insurmountable. It's the mind sinking down, viewing the past and future with overwhelming hopelessness.
                    </p>
                    <p class="mt-4 text-sm text-purple-500 font-medium">#Compassion #Connection #ProfessionalHelp</p>
                </div>
            </div>
        </section>

        <!-- 3. Statistics and Encouragement -->
        <section class="bg-purple-600 py-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-white text-center">
                <h2 class="text-3xl sm:text-4xl font-extrabold mb-4">Recovery Is Possible. Healing Is Real.</h2>
                <p class="text-lg mb-10 opacity-90">These challenges are common, treatable, and not a sign of weakness.</p>
                
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-8">
                    <!-- Stat 1 -->
                    <div class="p-6 bg-purple-700 rounded-xl">
                        <i class="ph-heart-straight text-4xl mb-3 text-pink-300"></i>
                        <p class="text-4xl font-bold">1 in 5</p>
                        <p class="mt-2 text-sm opacity-80">Adults experience a mental illness in a given year.</p>
                    </div>
                    <!-- Stat 2 -->
                    <div class="p-6 bg-purple-700 rounded-xl">
                        <i class="ph-lightbulb text-4xl mb-3 text-yellow-300"></i>
                        <p class="text-4xl font-bold">80%</p>
                        <p class="mt-2 text-sm opacity-80">Of people treated for depression show improvement.</p>
                    </div>
                    <!-- Stat 3 -->
                    <div class="p-6 bg-purple-700 rounded-xl">
                        <i class="ph-users text-4xl mb-3 text-teal-300"></i>
                        <p class="text-4xl font-bold">We See You</p>
                        <p class="mt-2 text-sm opacity-80">A community ready to support your journey.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. Resources Section -->
        <section id="resources" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <h2 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-12">Essential Tools and Resources</h2>

            <div class="grid md:grid-cols-3 gap-8">
                <!-- Resource 1: Professional Help -->
                <div class="card bg-white p-6 rounded-xl border border-gray-100">
                    <i class="ph-chats text-4xl text-green-600 mb-3"></i>
                    <h3 class="text-xl font-semibold mb-2">Talk to a Therapist</h3>
                    <p class="text-gray-600 text-sm mb-4">
                        Professional guidance can provide proven strategies and a confidential space to process feelings.
                    </p>
                    <button onclick="showResource('therapist')" class="text-green-600 font-medium hover:text-green-700 flex items-center focus:outline-none">
                        Find a Local Provider <i class="ph-arrow-right ml-2"></i>
                    </button>
                    <ul id="therapist-list" class="mt-4 text-left text-sm text-gray-700 hidden bg-green-50 rounded-lg p-4">
                        <li><strong>Hope Wellness Center</strong> – 123 Main St, Springfield</li>
                        <li><strong>Mindful Path Therapy</strong> – 456 Oak Ave, Riverdale</li>
                        <li><strong>Sunrise Counseling</strong> – 789 Pine Rd, Lakeside</li>
                        <li><strong>Community Mental Health Clinic</strong> – 101 Maple Dr, Midtown</li>
                    </ul>
                </div>

                <!-- Resource 2: Crisis Hotline -->
                <div class="card bg-white p-6 rounded-xl border border-gray-100">
                    <i class="ph-phone-call text-4xl text-red-600 mb-3"></i>
                    <h3 class="text-xl font-semibold mb-2">Crisis Hotline (24/7)</h3>
                    <p class="text-gray-600 text-sm mb-4">
                        If you are experiencing an emergency or immediate distress, please reach out now.
                    </p>
                    <button onclick="showResource('hotline')" class="text-red-600 font-medium hover:text-red-700 flex items-center focus:outline-none">
                        View All Hotlines <i class="ph-arrow-right ml-2"></i>
                    </button>
                    <ul id="hotline-list" class="mt-4 text-left text-sm text-gray-700 hidden bg-red-50 rounded-lg p-4">
                        <li><strong>988 Suicide & Crisis Lifeline (US):</strong> Call or Text 988</li>
                        <li><strong>Samaritans (UK):</strong> 116 123</li>
                        <li><strong>Lifeline (Australia):</strong> 13 11 14</li>
                        <li><strong>International Hotlines:</strong> <a href="https://www.opencounseling.com/suicide-hotlines" target="_blank" class="underline text-blue-700">Find your country</a></li>
                    </ul>
                </div>

                <!-- Resource 3: Self-Care & Community -->
                <div class="card bg-white p-6 rounded-xl border border-gray-100">
                    <i class="ph-leaf text-4xl text-yellow-600 mb-3"></i>
                    <h3 class="text-xl font-semibold mb-2">Mindfulness & Self-Care</h3>
                    <p class="text-gray-600 text-sm mb-4">
                        Small, daily practices can make a huge difference in managing symptoms over time.
                    </p>
                    <button onclick="showResource('selfcare')" class="text-yellow-600 font-medium hover:text-yellow-700 flex items-center focus:outline-none">
                        Add Your Own Membership <i class="ph-arrow-right ml-2"></i>
                    </button>
                    <div id="selfcare-form" class="mt-4 hidden bg-yellow-50 rounded-lg p-4">
                        <form onsubmit="event.preventDefault(); addMembership();">
                            <label class="block mb-2 text-sm font-medium text-gray-700">Membership/Practice Name:</label>
                            <input id="membership-input" type="text" class="w-full border border-yellow-300 rounded px-2 py-1 mb-2" placeholder="e.g., Calm App, Yoga Group" required />
                            <button type="submit" class="bg-yellow-500 text-white px-4 py-1 rounded hover:bg-yellow-600">Add</button>
                        </form>
                        <ul id="membership-list" class="mt-2 text-sm text-gray-700"></ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. Final Call to Action / Help Section -->
        <section id="help" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 text-center">
            <div class="bg-purple-100 p-8 sm:p-12 rounded-2xl border-4 border-purple-300 border-dashed">
                <h2 class="text-3xl sm:text-5xl font-extrabold text-purple-900 mb-4">Take the Next Step.</h2>
                <p class="text-xl text-purple-700 max-w-2xl mx-auto mb-8">
                    Whether it's a first step or a hundredth, reaching out is a powerful act of courage. Your wellness matters.
                </p>
                <div class="flex justify-center">
                    <a href="#" class="cta-button bg-purple-600 text-white text-lg sm:text-xl font-bold py-3 px-6 sm:py-4 sm:px-10 rounded-full shadow-2xl hover:bg-purple-800 transition duration-300 inline-flex items-center justify-center w-full sm:w-auto text-center whitespace-normal">
                        <i class="ph-hand-heart mr-2"></i>
                        <span>Find Immediate Support</span>
                    </a>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex justify-center space-x-6 mb-4">
                <a href="#" class="text-gray-400 hover:text-purple-400 transition"><i class="ph-instagram-logo text-2xl"></i></a>
                <a href="#" class="text-gray-400 hover:text-purple-400 transition"><i class="ph-twitter-logo text-2xl"></i></a>
                <a href="#" class="text-gray-400 hover:text-purple-400 transition"><i class="ph-envelope-simple text-2xl"></i></a>
                <button onclick="openShareModal()" class="text-gray-400 hover:text-purple-400 transition flex items-center space-x-2">
                    <i class="ph-share-network text-2xl"></i>
                    <span class="text-sm">Share</span>
                </button>
            </div>
            <p class="text-sm text-gray-500">
                &copy; 2024 Lighthouse Mental Wellness Advocacy. All rights reserved.
            </p>
            <p class="text-xs text-gray-600 mt-2">
                Disclaimer: This site is for informational and educational purposes only and is not a substitute for professional medical advice or treatment.
            </p>
        </div>
        <!-- Share Modal (hidden by default) -->
        <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 overlay-hidden items-center justify-center z-50">
            <div class="bg-white rounded-xl p-6 w-11/12 max-w-lg mx-auto modal-panel">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Share this page</h3>
                    <button onclick="closeShareModal()" class="text-gray-500 hover:text-gray-700 text-2xl leading-none">&times;</button>
                </div>
                <div>
                    <label class="text-sm text-gray-600">Page URL</label>
                    <div class="flex mt-2">
                        <input id="share-url" type="text" class="flex-1 border rounded px-2 py-1" readonly />
                        <button onclick="copyShareURL()" class="ml-2 bg-purple-600 text-white px-3 py-1 rounded">Copy</button>
                    </div>
                    <div class="mt-2 flex items-center space-x-2 text-sm">
                        <input id="custom-url-input" type="text" placeholder="Paste or type a URL to send to phone" class="flex-1 border rounded px-2 py-1" />
                        <button onclick="updateQRCodeFromInput()" class="ml-2 bg-gray-100 text-gray-800 px-3 py-1 rounded">Update QR</button>
                    </div>
                    <div class="mt-2 flex space-x-2">
                        <button onclick="shareToPhone()" class="bg-green-600 text-white px-3 py-1 rounded">Share (Phone)</button>
                        <button onclick="sendSMS()" class="bg-blue-600 text-white px-3 py-1 rounded">Send SMS</button>
                        <button onclick="shareWhatsApp()" class="bg-indigo-600 text-white px-3 py-1 rounded">WhatsApp</button>
                    </div>
                    <div class="mt-4">
                        <label class="text-sm text-gray-600">QR Code</label>
                        <div id="qrcode" class="mt-2"></div>
                        <button onclick="downloadQRCode()" class="mt-2 bg-gray-100 text-gray-800 px-3 py-1 rounded">Download QR</button>
                    </div>
                    <div class="mt-4 text-sm text-gray-700">
                        <p><strong>Open on another device in the same Wi‑Fi:</strong> If you're serving this site locally (e.g., http://localhost:3000), use the local IP below on your phone:</p>
                        <pre id="local-ips" class="bg-gray-100 p-2 rounded mt-2 text-xs">Detecting local addresses...</pre>
                        <p class="mt-3"><strong>Open from anywhere (different internet):</strong> use a tunneling service like <code>ngrok</code> or <code>localtunnel</code>. Example PowerShell commands are shown below.</p>
                        <pre class="bg-gray-100 p-2 rounded mt-2 text-xs"># Install localtunnel (Node.js required)
npm install -g localtunnel
# Expose port 3000
> lt --port 3000

# Or use ngrok (download & signin required)
> ngrok http 3000
</pre>
                    </div>
                </div>
                <div class="mt-4 text-right">
                    <button onclick="closeShareModal()" class="px-4 py-2 rounded bg-gray-200">Close</button>
                </div>
            </div>
        </div>

        <!-- QRCode library (small, client-side) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

        <!-- Immediate Support Modal -->
        <div id="immediate-modal" class="fixed inset-0 bg-black bg-opacity-60 overlay-hidden items-center justify-center z-60">
            <div class="bg-white rounded-xl p-6 w-11/12 max-w-2xl mx-auto modal-panel">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Immediate Support</h3>
                    <button onclick="closeImmediate()" class="text-gray-500 hover:text-gray-700 text-2xl leading-none">&times;</button>
                </div>
                <p class="text-sm text-gray-700">We can try to find nearby hospitals or crisis centers and offer ways to contact them. You can also choose to share your location to find the nearest services.</p>
                <div class="mt-4 flex space-x-3">
                    <button onclick="useGeolocation()" class="bg-red-600 text-white px-4 py-2 rounded">Find Nearby Hospitals</button>
                    <button onclick="goToSupportPage()" class="bg-purple-600 text-white px-4 py-2 rounded">Open Support Page</button>
                    <button onclick="closeImmediate()" class="bg-gray-200 px-4 py-2 rounded">Close</button>
                </div>
                <div id="immediate-status" class="mt-4 text-sm text-gray-600"></div>
                <div id="nearest-hospital" class="mt-4"></div>
                <div id="hospital-list" class="mt-4 space-y-3 hospital-list-scroll"></div>
            </div>
        </div>

        <!-- In-page Support "page" (same document) -->
        <div id="support-page" class="fixed inset-0 bg-white overlay-hidden z-70 overflow-auto">
            <div class="max-w-3xl mx-auto p-6 support-page">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">Immediate Support Options</h2>
                    <div class="flex items-center space-x-2">
                        <button onclick="closeSupportPage()" class="bg-gray-200 px-3 py-1 rounded">Close</button>
                        <button onclick="closeSupportPage()" class="bg-white border px-3 py-1 rounded text-sm">Back to Home</button>
                    </div>
                </div>
                <p class="text-gray-700">Here you can contact local hospitals, call a crisis hotline, or add your own membership/contact for quick access.</p>

                <section class="mt-6">
                    <h3 class="font-semibold">Crisis Hotlines</h3>
                    <ul class="mt-2 text-sm text-gray-800">
                        <li><strong>988 (US):</strong> Call or Text <a href="tel:988" class="text-blue-600">988</a></li>
                        <li><strong>Samaritans (UK):</strong> <a href="tel:+44116123" class="text-blue-600">116 123</a></li>
                        <li><strong>International:</strong> <a href="https://www.opencounseling.com/suicide-hotlines" target="_blank" class="text-blue-600">Find your country</a></li>
                    </ul>
                </section>

                <section class="mt-6">
                    <h3 class="font-semibold">Nearby Hospitals</h3>
                    <div class="mt-2 hospital-list-scroll" id="support-hospitals">No location chosen. Click "Find Nearby Hospitals" in the Immediate Support popup to search.</div>
                </section>

                <section class="mt-6">
                    <h3 class="font-semibold">Your Memberships / Quick Contacts</h3>
                    <div id="quick-contacts" class="mt-2">
                        <form id="quick-contact-form" onsubmit="event.preventDefault(); addQuickContact();">
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                <input id="qc-name" class="border px-2 py-1 rounded col-span-2" placeholder="Name (e.g., Local Hospital)" required />
                                <input id="qc-phone" class="border px-2 py-1 rounded" placeholder="Phone (optional)" />
                            </div>
                            <div class="mt-2">
                                <button type="submit" class="bg-yellow-500 text-white px-3 py-1 rounded">Add</button>
                            </div>
                        </form>
                        <ul id="qc-list" class="mt-3 space-y-2 text-sm"></ul>
                    </div>
                </section>
            </div>
        </div>
        </div>
    </footer>
<script>
// Toggle resource lists
function showResource(type) {
    // Hide all
    document.getElementById('therapist-list').classList.add('hidden');
    document.getElementById('hotline-list').classList.add('hidden');
    document.getElementById('selfcare-form').classList.add('hidden');
    // Show selected
    if (type === 'therapist') {
        document.getElementById('therapist-list').classList.toggle('hidden');
    } else if (type === 'hotline') {
        document.getElementById('hotline-list').classList.toggle('hidden');
    } else if (type === 'selfcare') {
        document.getElementById('selfcare-form').classList.toggle('hidden');
    }
}
// Add membership to self-care list
function addMembership() {
    const input = document.getElementById('membership-input');
    const list = document.getElementById('membership-list');
    if (input.value.trim() !== '') {
        const li = document.createElement('li');
        li.textContent = input.value.trim();
        list.appendChild(li);
        input.value = '';
    }
}
</script>
<script>
// Share modal functions
function openShareModal() {
    const modal = document.getElementById('share-modal');
    modal.classList.remove('overlay-hidden');
    modal.classList.add('overlay-visible');
    const panel = modal.querySelector('.modal-panel');
    requestAnimationFrame(()=>panel.classList.add('modal-panel-enter'));
    const urlInput = document.getElementById('share-url');
    // Use current location.href by default
    let pageUrl = location.href;
    // If served from localhost, keep localhost; otherwise keep actual URL
    urlInput.value = pageUrl;
    generateQRCode(pageUrl);
    detectLocalIPs();
}
function closeShareModal() {
    const modal = document.getElementById('share-modal');
    const panel = modal.querySelector('.modal-panel');
    panel.classList.remove('modal-panel-enter');
    modal.classList.remove('overlay-visible');
    modal.classList.add('overlay-hidden');
}

function copyShareURL() {
    const urlInput = document.getElementById('share-url');
    urlInput.select();
    urlInput.setSelectionRange(0, 99999); // mobile
    try {
        document.execCommand('copy');
        alert('Link copied to clipboard');
    } catch (e) {
        navigator.clipboard?.writeText(urlInput.value).then(()=>alert('Link copied to clipboard'));
    }
}

let qrcodeInstance = null;
function generateQRCode(text) {
    const container = document.getElementById('qrcode');
    container.innerHTML = '';
    qrcodeInstance = new QRCode(container, {
        text: text,
        width: 160,
        height: 160,
        colorDark : '#000000',
        colorLight : '#ffffff',
        correctLevel : QRCode.CorrectLevel.H
    });
}

function downloadQRCode() {
    const container = document.getElementById('qrcode');
    const img = container.querySelector('img');
    if (img) {
        const url = img.src;
        const a = document.createElement('a');
        a.href = url;
        a.download = 'lighthouse-qr.png';
        document.body.appendChild(a);
        a.click();
        a.remove();
    } else {
        // older canvas fallback
        const canvas = container.querySelector('canvas');
        if (canvas) {
            const url = canvas.toDataURL('image/png');
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lighthouse-qr.png';
            document.body.appendChild(a);
            a.click();
            a.remove();
        } else {
            alert('QR code not found');
        }
    }
}

function updateQRCodeFromInput() {
    const input = document.getElementById('custom-url-input');
    const url = input.value.trim();
    if (!url) { alert('Please enter a URL'); return; }
    document.getElementById('share-url').value = url;
    generateQRCode(url);
}

async function shareToPhone() {
    const url = document.getElementById('share-url').value || location.href;
    // use Web Share API if available (works on mobile Chrome)
    if (navigator.share) {
        try {
            await navigator.share({ title: document.title, url });
            return;
        } catch (e) { /* user cancelled or failed */ }
    }
    // fallback: copy to clipboard and instruct user
    copyTextToClipboard(url);
    alert('Link copied to clipboard. Paste it into your phone or scan the QR.');
}

function sendSMS() {
    const url = encodeURIComponent(document.getElementById('share-url').value || location.href);
    // sms: scheme may vary; use body parameter
    const smsLink = `sms:?&body=${url}`;
    window.location.href = smsLink;
}

function shareWhatsApp() {
    const url = encodeURIComponent(document.getElementById('share-url').value || location.href);
    const waLink = `https://wa.me/?text=${url}`;
    window.open(waLink, '_blank');
}

// Detect local IPs via WebRTC trick (best-effort, works in many browsers)
function detectLocalIPs() {
    const output = document.getElementById('local-ips');
    output.textContent = 'Detecting local addresses...';
    const ips = new Set();
    // Compatibility
    const RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
    if (!RTCPeerConnection) {
        output.textContent = 'Local IP detection not supported in this browser.';
        return;
    }
    const pc = new RTCPeerConnection({iceServers:[]});
    pc.createDataChannel('');
    pc.onicecandidate = (e) => {
        if (!e.candidate) {
            // finished
            if (ips.size === 0) output.textContent = 'No local addresses detected.';
            else output.textContent = Array.from(ips).join('\n');
            pc.close();
            return;
        }
        const parts = e.candidate.candidate.split(' ');
        for (const part of parts) {
            // IPv4/IPv6 regex
            const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9:]+)/i;
            const m = ipRegex.exec(part);
            if (m) ips.add(m[1]);
        }
    };
    pc.createOffer().then(offer=>pc.setLocalDescription(offer)).catch(()=>{
        output.textContent = 'Could not create WebRTC offer. Local IP detection failed.';
    });
}
</script>
<script>
// Immediate Support functions
function openImmediate() {
    const modal = document.getElementById('immediate-modal');
    const panel = modal.querySelector('.modal-panel');
    // reset enter class so repeated opens animate
    panel.classList.remove('modal-panel-enter');
    // force reflow
    void panel.offsetWidth;
    modal.classList.remove('overlay-hidden');
    modal.classList.add('overlay-visible');
    requestAnimationFrame(()=>panel.classList.add('modal-panel-enter'));
}
function closeImmediate() {
    const modal = document.getElementById('immediate-modal');
    const panel = modal.querySelector('.modal-panel');
    panel.classList.remove('modal-panel-enter');
    modal.classList.remove('overlay-visible');
    modal.classList.add('overlay-hidden');
}



function useGeolocation() {
    const status = document.getElementById('immediate-status');
    status.textContent = 'Requesting location…';
    if (!navigator.geolocation) {
        status.textContent = 'Geolocation not supported by your browser.';
        return;
    }
    navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        status.textContent = `Location: ${lat.toFixed(4)}, ${lon.toFixed(4)} — searching nearby hospitals...`;
        const hospitals = await findNearbyHospitals(lat, lon, 5000); // 5 km radius
        renderHospitalList(hospitals, lat, lon);
    }, (err) => {
        status.textContent = 'Unable to retrieve your location: ' + (err.message || err.code);
    }, {enableHighAccuracy:true, timeout:10000});
}

async function findNearbyHospitals(lat, lon, radiusMeters) {
    // Overpass QL: find amenity=hospital or emergency=hospital or healthcare=hospital
    const query = `[
out:json][timeout:10];(
  node[amenity=hospital](around:${radiusMeters},${lat},${lon});
  way[amenity=hospital](around:${radiusMeters},${lat},${lon});
  node[healthcare=hospital](around:${radiusMeters},${lat},${lon});
  way[healthcare=hospital](around:${radiusMeters},${lat},${lon});
);
out center 20;`;
    const url = 'https://overpass-api.de/api/interpreter';
    try {
        const res = await fetch(url, {method:'POST', body: query});
        const data = await res.json();
        // map elements to simple objects
        const items = data.elements.map(el => {
            const tags = el.tags || {};
            const name = tags.name || tags.operator || 'Unnamed Hospital';
            // look for many possible phone tag variants
            const phoneCandidates = [tags.phone, tags.telephone, tags['contact:phone'], tags['contact:telephone'], tags['contact:mobile'], tags.mobile, tags['phone:mobile']];
            let phone = '';
            for (const p of phoneCandidates) {
                if (p && p.toString().trim()) { phone = p.toString().trim(); break; }
            }
            // normalize: sometimes multiple numbers are separated by ; or , -> take first and remove extras
            if (phone) {
                phone = phone.split(/[,;\/\\|]/)[0].trim();
            }
            const latp = el.lat || (el.center && el.center.lat);
            const lonp = el.lon || (el.center && el.center.lon);
            return {id: el.id, name, phone, lat: latp, lon: lonp, tags};
        });
        return items;
    } catch (e) {
        console.error('Overpass error', e);
        return [];
    }
}

function renderHospitalList(hospitals, userLat, userLon) {
    const container = document.getElementById('hospital-list');
    container.innerHTML = '';
    const nearestEl = document.getElementById('nearest-hospital');
    if (nearestEl) nearestEl.innerHTML = '';
    if (!hospitals || hospitals.length === 0) {
        container.innerHTML = '<div class="text-sm text-gray-600">No hospitals found nearby.</div>';
        supportHosp.textContent = 'No nearby hospitals found.';
        return;
    }
    // compute distances and find nearest if user location provided
    let nearest = null;
    if (typeof userLat === 'number' && typeof userLon === 'number') {
        hospitals.forEach(h => {
            if (!h.lat || !h.lon) { h._dist = Infinity; return; }
            const d = haversineDistance(userLat, userLon, h.lat, h.lon);
            h._dist = d;
            if (!nearest || d < nearest._dist) nearest = h;
        });
    }
    hospitals.slice(0,10).forEach(h => {
        const div = document.createElement('div');
        div.className = 'p-3 border rounded bg-gray-50';
        const title = document.createElement('div');
        title.className = 'font-semibold';
        title.textContent = h.name;
    const details = document.createElement('div');
    details.className = 'text-sm text-gray-700 mt-1';
    const phoneHtml = h.phone ? `<a href="tel:${h.phone}" class="text-blue-600">${h.phone}</a>` : 'N/A';
    details.innerHTML = `Phone: ${phoneHtml}`;
        const actions = document.createElement('div');
        actions.className = 'mt-2 flex space-x-2';
        const callBtn = document.createElement('a');
        callBtn.href = h.phone ? `tel:${h.phone}` : '#';
        callBtn.className = 'bg-red-500 text-white px-3 py-1 rounded';
        callBtn.textContent = h.phone ? 'Call' : 'No phone';
        const mapBtn = document.createElement('a');
        mapBtn.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(h.lat + ',' + h.lon)}`;
        mapBtn.target = '_blank';
        mapBtn.className = 'bg-blue-500 text-white px-3 py-1 rounded';
        mapBtn.textContent = 'Directions';
        const copyBtn = document.createElement('button');
        copyBtn.className = 'bg-gray-200 px-3 py-1 rounded';
        copyBtn.textContent = 'Copy Contact';
        copyBtn.onclick = () => {
            const text = `${h.name}${h.phone ? ' — ' + h.phone : ''} — https://www.google.com/maps/search/?api=1&query=${h.lat},${h.lon}`;
            copyTextToClipboard(text);
            alert('Contact copied to clipboard');
        };
        actions.appendChild(callBtn);
        actions.appendChild(mapBtn);
        actions.appendChild(copyBtn);
        div.appendChild(title);
        div.appendChild(details);
        div.appendChild(actions);
        container.appendChild(div);
    });
    // show nearest prominently
    if (nearest && nearestEl) {
        const wrapper = document.createElement('div');
        wrapper.className = 'p-3 mb-3 rounded bg-yellow-50 border border-yellow-200';
        const name = document.createElement('div');
        name.className = 'font-bold text-lg';
        name.textContent = `Nearest: ${nearest.name}`;
        const phoneDiv = document.createElement('div');
        phoneDiv.className = 'text-sm text-gray-700 mt-1';
        phoneDiv.innerHTML = nearest.phone ? `<a href="tel:${nearest.phone}" class="text-blue-600">${nearest.phone}</a>` : 'Phone: N/A';
        const actions = document.createElement('div');
        actions.className = 'mt-2 flex space-x-2';
        if (nearest.phone) {
            const call = document.createElement('a');
            call.href = `tel:${nearest.phone}`;
            call.className = 'bg-red-600 text-white px-3 py-1 rounded';
            call.textContent = 'Call Now';
            actions.appendChild(call);
        }
        const copy = document.createElement('button');
        copy.className = 'bg-gray-200 px-3 py-1 rounded';
        copy.textContent = 'Copy Info';
        copy.onclick = () => { copyTextToClipboard(`${nearest.name} ${nearest.phone ? nearest.phone : ''}`); alert('Copied'); };
        actions.appendChild(copy);
        wrapper.appendChild(name);
        wrapper.appendChild(phoneDiv);
        wrapper.appendChild(actions);
        nearestEl.appendChild(wrapper);
    }
    // Also populate the support-page section
    const supportHosp = document.getElementById('support-hospitals');
    supportHosp.innerHTML = '';
    hospitals.slice(0,6).forEach(h => {
        const li = document.createElement('div');
        li.className = 'p-2 border-b flex justify-between items-center';
        const phoneText = h.phone ? `<a href="tel:${h.phone}" class="text-blue-600">${h.phone}</a>` : 'Phone: N/A';
        li.innerHTML = `<div><div class="font-medium">${h.name}</div><div class="text-xs text-gray-600">${phoneText}</div></div>`;
        const right = document.createElement('div');
        right.className = 'flex space-x-2';
    const call = document.createElement('a');
    call.href = h.phone ? `tel:${h.phone}` : '#';
    call.textContent = 'Call';
    call.className = 'text-white bg-red-600 px-2 py-1 rounded text-sm';
    call.onclick = (e) => { if (!h.phone) e.preventDefault(); };
        const copy = document.createElement('button');
        copy.className = 'bg-gray-200 px-2 py-1 rounded text-sm';
        copy.textContent = 'Copy';
    copy.onclick = () => { copyTextToClipboard(`${h.name} ${h.phone ? h.phone : ''}`); alert('Copied'); };
        const dir = document.createElement('a');
        dir.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(h.lat + ',' + h.lon)}`;
        dir.target = '_blank';
        dir.className = 'text-white bg-blue-600 px-2 py-1 rounded text-sm';
        dir.textContent = 'Map';
        right.appendChild(call);
        right.appendChild(copy);
        right.appendChild(dir);
        li.appendChild(right);
        supportHosp.appendChild(li);
    });
}

// distance in meters between two lat/lon pairs
function haversineDistance(lat1, lon1, lat2, lon2) {
    function toRad(deg) { return deg * Math.PI / 180; }
    const R = 6371000; // metres
    const phi1 = toRad(lat1);
    const phi2 = toRad(lat2);
    const dphi = toRad(lat2 - lat1);
    const dlambda = toRad(lon2 - lon1);
    const a = Math.sin(dphi/2) * Math.sin(dphi/2) + Math.cos(phi1) * Math.cos(phi2) * Math.sin(dlambda/2) * Math.sin(dlambda/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

// When opening/closing the in-page support view, lock body scroll so background doesn't interfere
let _supportEscHandler = null;
let _supportHistoryPushed = false;
function goToSupportPage() {
    // ensure immediate modal closed
    closeImmediate();
    const pageWrap = document.getElementById('support-page');
    const page = pageWrap.querySelector('.support-page');
    // reset enter class to allow repeated animations
    page.classList.remove('support-page-enter');
    void page.offsetWidth;
    pageWrap.classList.remove('overlay-hidden');
    pageWrap.classList.add('overlay-visible');
    requestAnimationFrame(()=>page.classList.add('support-page-enter'));
    document.body.style.overflow = 'hidden';
    // focus first heading for accessibility
    const h = page.querySelector('h2'); if (h) h.focus = true;
    // add ESC handler to close
    _supportEscHandler = (e) => { if (e.key === 'Escape') closeSupportPage(); };
    document.addEventListener('keydown', _supportEscHandler);
    // push history state so browser Back closes the support overlay
    if (history && history.pushState) {
        try {
            history.pushState({supportOpen:true}, 'support');
            _supportHistoryPushed = true;
        } catch (e) { /* ignore */ }
    }
}
function closeSupportPage() {
    const pageWrap = document.getElementById('support-page');
    const page = pageWrap.querySelector('.support-page');
    page.classList.remove('support-page-enter');
    pageWrap.classList.remove('overlay-visible');
    pageWrap.classList.add('overlay-hidden');
    document.body.style.overflow = '';
    // remove ESC handler
    if (_supportEscHandler) document.removeEventListener('keydown', _supportEscHandler);
    _supportEscHandler = null;
    // ensure immediate modal closed as well (use closeImmediate to keep behavior consistent)
    try { closeImmediate(); } catch (e) { /* ignore */ }
    // clear history push flag since we've programmatically closed the page
    _supportHistoryPushed = false;
    // navigate back to top/home section and restore scroll position
    try { navigate('home'); window.scrollTo({top:0, behavior:'smooth'}); } catch (e) {}
}

// Handle browser Back button
window.addEventListener('popstate', function (e) {
    // if we pushed a support state and now a pop happens, close support without adding another history entry
    if (_supportHistoryPushed) {
        _supportHistoryPushed = false;
        // if support is visible, close it
        const page = document.getElementById('support-page');
        if (page && page.classList && !page.classList.contains('overlay-hidden')) {
            closeSupportPage();
        }
    }
});

// Ensure initial state and safe body overflow
document.addEventListener('DOMContentLoaded', () => {
    // make sure overlays are hidden initially
    ['share-modal','immediate-modal','support-page'].forEach(id=>{
        const el = document.getElementById(id);
        if (el && !el.classList.contains('overlay-hidden')) el.classList.add('overlay-hidden');
    });
    document.body.style.overflow = '';
});

function copyTextToClipboard(text) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).catch(()=>{
            // fallback
            const ta = document.createElement('textarea');
            ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
        });
    } else {
        const ta = document.createElement('textarea');
        ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
    }
}

// Quick contacts (memberships) stored in memory for this session
function addQuickContact() {
    const name = document.getElementById('qc-name').value.trim();
    const phone = document.getElementById('qc-phone').value.trim();
    if (!name) return;
    const list = document.getElementById('qc-list');
    const li = document.createElement('li');
    li.className = 'flex justify-between items-center border p-2 rounded';
    li.innerHTML = `<div><div class="font-medium">${escapeHtml(name)}</div><div class="text-xs text-gray-600">${escapeHtml(phone)}</div></div>`;
    const right = document.createElement('div');
    right.className = 'flex space-x-2';
    const call = document.createElement('a');
    call.href = phone ? `tel:${phone}` : '#';
    call.className = 'bg-red-500 text-white px-2 py-1 rounded text-sm';
    call.textContent = 'Call';
    const copy = document.createElement('button');
    copy.className = 'bg-gray-200 px-2 py-1 rounded text-sm';
    copy.textContent = 'Copy';
    copy.onclick = () => { copyTextToClipboard(`${name} ${phone}`); alert('Copied to clipboard'); };
    right.appendChild(call);
    right.appendChild(copy);
    li.appendChild(right);
    list.appendChild(li);
    document.getElementById('qc-name').value = '';
    document.getElementById('qc-phone').value = '';
}

function escapeHtml(s) {
    return s.replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]);
}
</script>
</body>
</html>
